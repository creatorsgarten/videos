WEBVTT

00:00:00.400 --> 00:00:01.000
ปั๊บ

00:00:01.900 --> 00:00:05.500
เดี๋ยวขอเสียงปรบมือให้ออมนะครับผม

00:00:05.900 --> 00:00:10.700
กับหัวข้อ พูดชื่อเองแล้วกันนะครับ

00:00:11.500 --> 00:00:12.900
ได้ครับ ก็วันนี้ไม่มี

00:00:13.900 --> 00:00:14.800
ขอบคุณมากครับ

00:00:16.900 --> 00:00:17.400
เอ๊ย

00:00:17.400 --> 00:00:20.500
โอเค วันนี้ก็จะมาพูดเรื่องว่า

00:00:20.500 --> 00:00:24.400
ในการทำ framework อ่ะ มันมีสกิลต้องแบบ

00:00:24.400 --> 00:00:26.000
ต้องมีสกิลตอแหลนิดนึง ก็คือ

00:00:26.000 --> 00:00:27.300
Social Engineering นี่แหละ

00:00:28.700 --> 00:00:30.800
ก็คือ แนะนำตัวนิดนึงก็คือ

00:00:30.800 --> 00:00:33.900
ผมทำ framework ชื่อ Elysia คือตัวนี้

00:00:34.100 --> 00:00:35.300
ตอนนี้มี

00:00:36.700 --> 00:00:37.500
อุ้ย เขิน

00:00:38.200 --> 00:00:42.000
มีดาวอยู่ประมาณ 8.5 ดาวมั้ง ประมาณ

00:00:42.000 --> 00:00:44.400
8,500 นั่นแหละ ก็

00:00:45.800 --> 00:00:46.900
เจมส์จับเวลาด้วย

00:00:46.900 --> 00:00:48.700
8.5 นี่คือมี 8 คน แล้วอีกครึ่งคน

00:00:50.100 --> 00:00:50.500
ใช่ 8 คนแล้วอีกครึ่งคน

00:00:50.500 --> 00:00:51.100
ฮะ โอเค

00:00:51.800 --> 00:00:52.900
นั่นแหละ ก็

00:00:52.900 --> 00:00:55.000
จะมาเล่านิดนึงว่า จริงๆแล้วเนี่ย

00:00:55.000 --> 00:00:57.200
คือแบบ อันนี้มันเป็นเหมือน framework

00:00:57.200 --> 00:00:58.500
ในการทำแบบเว็บเซิร์ฟเวอร์เนาะ ก็

00:00:58.500 --> 00:01:00.700
API มันจะคล้ายๆ Express นี่แหละ

00:01:01.000 --> 00:01:03.100
ทีนี้เนี่ย มันจะมีฟีเจอร์บางอัน

00:01:03.100 --> 00:01:05.900
ที่มันแบบค่อนข้างดูเป็นเมจิกนิดนึง ก็คือ

00:01:05.900 --> 00:01:07.600
อันนึงเรียกว่า End-to-End Type Safety

00:01:07.600 --> 00:01:11.300
ก็คือ เราเขียนโค้ดบนเซิร์ฟเวอร์อ่ะ หน้าตาเป็นอย่างงี้

00:01:11.300 --> 00:01:14.000
ปึ๊บ อ่ะ เป็นปกติเลย แล้วเราก็ export type มา

00:01:14.500 --> 00:01:14.800
ทีนี้

00:01:14.800 --> 00:01:17.200
เราย้ายไปอีก repo นึง มาที่หน้าบ้านเนาะ

00:01:17.500 --> 00:01:18.900
แล้วทีนี้ เราก็จะสามารถ

00:01:19.100 --> 00:01:21.600
import แค่ type มา ปึ๊บ เราก็จะสามารถ

00:01:21.600 --> 00:01:23.500
interact กับตัวเซิร์ฟเวอร์ได้ โดยที่แบบ

00:01:23.500 --> 00:01:24.800
ปกติจะต้องเขียน fetch เนาะ

00:01:24.800 --> 00:01:26.000
แต่ปัญหาก็คือ

00:01:26.000 --> 00:01:27.400
พอเราเขียน fetch เงี้ย

00:01:27.400 --> 00:01:29.900
สมมุติ endpoint เรา เขียน type มาเรียบร้อยละ

00:01:29.900 --> 00:01:31.900
อ่ะ เราก็ต้องมาเขียนหน้าบ้าน หลังบ้านแยกกันเนาะ

00:01:31.900 --> 00:01:34.800
เขียน type ทีนี้ สมมุติหลังบ้านเนี่ย

00:01:34.800 --> 00:01:36.100
เค้าเกิดแบบเปลี่ยนใจว่า

00:01:36.400 --> 00:01:37.900
โปรเจคเมเนเจอร์ อยากให้แบบ

00:01:37.900 --> 00:01:39.900
เปลี่ยนฟิลด์ เพิ่มฟิลด์นู่น เพิ่มฟิลด์นี่

00:01:39.900 --> 00:01:41.400
หรืออาจจะเปลี่ยน structure อะไรเงี้ย

00:01:41.500 --> 00:01:43.800
มันก็จะมีปัญหาว่า หน้าบ้านกับหลังบ้าน

00:01:43.800 --> 00:01:44.600
มันไม่ซิงค์กันเนาะ

00:01:44.800 --> 00:01:46.800
ก็แต่ฟีเจอร์เนี่ย มันสามารถทำให้เรา

00:01:46.800 --> 00:01:48.500
สามารถซิงค์ type กันได้ ก็คือ

00:01:48.500 --> 00:01:50.700
ถ้าคุณเขียนหน้าบ้านอย่างงี้อ่ะ เดี๋ยวเรา

00:01:50.700 --> 00:01:52.100
จะเอาเข้า code editor ให้ดูเลย

00:01:52.100 --> 00:01:52.900
ว่ามันทำงานยังไงเนาะ

00:01:53.800 --> 00:01:55.100
ก็ก๊อปปี้นี่มา นะ

00:01:55.400 --> 00:01:56.000
ก็

00:01:56.400 --> 00:01:58.700
วิธีการเริ่มเขียนเนาะ ง่ายมาก ก็คือ

00:01:58.900 --> 00:02:00.200
ปึ๊บ เปิด

00:02:00.600 --> 00:02:03.600
ใหญ่สุดแล้วป่ะ ใหญ่สุดได้แค่นี้ โอเค ไม่เป็นไร

00:02:03.600 --> 00:02:05.000
ปึ๊บ เราก็ไป demo เนาะ

00:02:05.000 --> 00:02:07.900
ปึ๊บ เราก็รัน bun create

00:02:07.900 --> 00:02:09.600
elysia แล้วก็ชื่อโฟลเดอร์ ปึ๊บ

00:02:09.600 --> 00:02:10.500
ก็จะได้เป็น

00:02:12.400 --> 00:02:13.600
ทำไม bun ช้าจัง

00:02:13.800 --> 00:02:14.700
โอ้ยมันไม่มีแคช

00:02:14.700 --> 00:02:16.700
ไม่ได้ลงมานานแล้วปุ๊บเราก็จะได้ฟีเจอร์

00:02:16.700 --> 00:02:18.300
Elysia มาปุ๊บรันเซิร์ฟเวอร์

00:02:18.800 --> 00:02:20.400
เปิด localhost

00:02:20.500 --> 00:02:21.800
ก็จะรันเซิร์ฟเวอร์ปุ๊บ

00:02:22.300 --> 00:02:23.100
ได้อย่างงี้

00:02:23.300 --> 00:02:25.200
ทีนี้เรารอลองดู

00:02:25.300 --> 00:02:26.300
โค้ดดูแล้วกันมา

00:02:26.500 --> 00:02:28.200
ปุ๊บเรียกโค้ด VS code เนาะ

00:02:28.600 --> 00:02:30.400
อุ้ย ผิดอัน

00:02:30.800 --> 00:02:32.400
index.ts ปุ๊บ

00:02:32.700 --> 00:02:34.400
หน้าตาจะเป็นประมาณอย่างงี้เนาะ

00:02:34.600 --> 00:02:36.800
ก็เรียกมา มีเซิร์ฟเวอร์มีอะไรเรียบร้อย

00:02:37.100 --> 00:02:38.200
รันปุ๊บมันก็จะได้เซิร์ฟเวอร์มา

00:02:38.800 --> 00:02:39.800
โค้ดสว่าง

00:02:42.000 --> 00:02:44.200
คือถ้าเราใช้จอมืดบนหน้าเนี่ย

00:02:44.200 --> 00:02:45.200
มันจะมองไม่เห็น

00:02:45.200 --> 00:02:46.500
ผมเคยทำมาหลายรอบแล้ว

00:02:46.500 --> 00:02:47.800
ก็เลยใช้เป็นธีมขาว

00:02:47.800 --> 00:02:48.500
อันนี้โม้นะแหละ

00:02:48.500 --> 00:02:50.400
เพราะว่าจริงๆ แล้วผมติดตาเฉยๆ

00:02:50.400 --> 00:02:51.400
สมมุติเราอยากเพิ่ม endpoint

00:02:51.700 --> 00:02:53.400
endpoint อันนึงเราก็เขียนอย่างงี้เนาะ

00:02:53.400 --> 00:02:53.900
แล้วก็

00:02:54.200 --> 00:02:55.900
ปุ๊บ return something มาประมาณ

00:02:55.900 --> 00:02:56.600
เป็นอย่างงี้

00:02:56.600 --> 00:02:58.100
อยากส่งค่าอะไรกลับไปก็จะได้

00:02:58.100 --> 00:02:58.900
endpoint อย่างงี้มา

00:02:59.300 --> 00:03:00.000
ทีนี้สมมุติ

00:03:00.400 --> 00:03:01.700
ผมเกิดอยากได้ body มา

00:03:01.700 --> 00:03:02.900
ก็คืออยากให้แบบ

00:03:03.300 --> 00:03:04.600
API มันรับ endpoint มา

00:03:04.600 --> 00:03:06.500
ผมก็จะเขียน body แล้วกำหนด type มา

00:03:06.500 --> 00:03:08.000
ปุ๊บ สมมุติเอาเป็น object

00:03:08.400 --> 00:03:09.100
แล้วก็

00:03:09.200 --> 00:03:10.100
ส่ง name มา

00:03:10.100 --> 00:03:11.200
อะไรประมาณอย่างงี้

00:03:11.200 --> 00:03:11.700
ปุ๊บ

00:03:11.700 --> 00:03:13.200
เราก็จะได้ endpoint มาอันนึงเนาะ

00:03:13.200 --> 00:03:13.900
แต่อันนี้

00:03:13.900 --> 00:03:15.200
เรายังไม่มีหน้าตาเนาะ

00:03:15.200 --> 00:03:16.700
เพราะฉะนั้นเดี๋ยวผมโหลด Swagger มา

00:03:16.700 --> 00:03:17.200
นิดนึง

00:03:17.600 --> 00:03:18.100
ก็คือโหลด

00:03:18.900 --> 00:03:22.000
elysiajs/swagger ปุ๊บ

00:03:22.000 --> 00:03:24.100
แล้วเราก็ยัด Swagger ใส่

00:03:24.700 --> 00:03:26.400
use(swagger()) ปุ๊บ

00:03:27.500 --> 00:03:28.600
โอเค มา

00:03:28.900 --> 00:03:30.100
ก็จะได้อย่างงี้

00:03:30.100 --> 00:03:31.300
รันปุ๊บแล้วก็ไปที่

00:03:31.600 --> 00:03:32.500
หน้าบ้านเนาะ

00:03:33.400 --> 00:03:35.800
ปุ๊บ เรา /swagger ปุ๊บ

00:03:36.000 --> 00:03:37.700
ก็จะได้หน้า Swagger มาอย่างงี้

00:03:38.300 --> 00:03:39.700
ทีนี้เนี่ย

00:03:40.100 --> 00:03:41.900
มันจะมีเมจิกนิดนึงก็คือ

00:03:42.400 --> 00:03:43.800
คือมันไม่ใช่ Swagger ด้วยซ้ำ

00:03:44.600 --> 00:03:47.000
เฮ้ย มันปรับเป็น Swagger ได้ด้วยนะ

00:03:47.900 --> 00:03:48.500
เนี่ย เรา

00:03:48.500 --> 00:03:49.100
เราปรับเป็น

00:03:49.700 --> 00:03:50.600
มันชื่ออะไรวะ

00:03:50.800 --> 00:03:52.300
มันชื่ออะไรวะ ลืมละ

00:03:52.400 --> 00:03:54.400
provider ใช่

00:03:54.400 --> 00:03:55.500
แล้วก็ swagger-ui ปุ๊บ

00:03:55.800 --> 00:03:57.300
เซฟ แล้วก็รีโหลด

00:03:57.300 --> 00:03:58.300
มันก็จะได้มาเป็น

00:04:00.200 --> 00:04:01.300
Swagger

00:04:01.300 --> 00:04:02.200
ได้ Swagger มา

00:04:05.700 --> 00:04:09.300
ทีนี้ endpoint เนี่ย สมมุติว่าเรามี endpoint นี้ใช่ไหม

00:04:09.400 --> 00:04:10.300
ตอนเนี้ย endpoint เนี่ย

00:04:10.400 --> 00:04:12.800
มันรับ name มา แล้วก็จะส่งค่ากลับมาเนาะ

00:04:12.800 --> 00:04:14.500
สมมุติในอนาคตเนี่ย

00:04:15.100 --> 00:04:18.900
เราอยากเพิ่ม field 1 อัน แล้วก็เพิ่ม age มา

00:04:19.200 --> 00:04:20.800
ปึ๊บ มันก็จะมาโผล่ในนี้เนาะ

00:04:20.800 --> 00:04:22.600
แต่ทีนี้ปัญหาคือ สมมุติเราทำอย่างงี้

00:04:23.300 --> 00:04:24.700
frontend ที่เขียนหน้าบ้านเราเนี่ย

00:04:24.900 --> 00:04:26.600
ก็จะไม่รู้ว่า type ตรงนี้มันเปลี่ยน

00:04:26.700 --> 00:04:28.900
แล้วก็ต้องไป slack ไปบอก frontend ว่า

00:04:29.300 --> 00:04:32.300
มันมี field ตรงนี้เพิ่มมานะ แล้วคิดภาพสมมุติว่า

00:04:32.600 --> 00:04:35.600
เราทำการ migration ครั้งใหญ่เงี้ย field มันเปลี่ยนหมดเลย

00:04:35.700 --> 00:04:37.800
หรือแบบเพิ่ม endpoint แบบ v1 v2 อะไรเงี้ย

00:04:38.000 --> 00:04:39.100
มันก็จะมีปัญหาใช่ไหม

00:04:39.600 --> 00:04:43.100
ทีนี้ เราก็เลยแก้ปัญหาด้วยการเพิ่มตัว end-to-end type safety

00:04:43.100 --> 00:04:47.400
เมื่อกี้ก็คือเราลง plugin ชื่อ eden เนาะ

00:04:47.600 --> 00:04:49.100
แล้วก็โหลดเข้ามา รอแป๊บนึง

00:04:49.400 --> 00:04:52.900
ทีนี้ อันนี้มันเป็นปกติจะใช้ monorepo เนาะ

00:04:53.100 --> 00:04:54.500
แต่อันนี้ขอเป็นไฟล์เดียวเลย

00:04:54.600 --> 00:04:55.700
จะได้เห็นว่ามันทำอะไรได้เนาะ

00:04:55.900 --> 00:04:57.900
เพราะว่า setup monorepo มันนานนิดนึง

00:04:58.200 --> 00:05:01.600
แล้วก็ import มา edenTreaty ปึ๊บ

00:05:01.700 --> 00:05:02.200
import function นี้มา

00:05:02.300 --> 00:05:04.500
แล้วเราก็สร้าง type ขึ้นมา 1 อัน

00:05:04.900 --> 00:05:07.200
type App แล้วกัน typeof App ปึ๊บ

00:05:07.400 --> 00:05:10.400
ทีนี้ ตัวหน้าบ้านเนี่ย คิดสภาพว่าอันนี้เป็นหน้าบ้านแล้วกัน

00:05:10.500 --> 00:05:12.900
ผมสร้างไฟล์ใหม่แล้วกัน จะได้เห็นเนาะ

00:05:13.400 --> 00:05:18.000
เอา b.ts ปึ๊บ สร้างหน้าบ้านมา

00:05:18.200 --> 00:05:21.900
โอเค ประมาณอย่างงี้ ผมก็ import ตัวเมื่อกี้มา

00:05:22.100 --> 00:05:24.700
edenTreaty ปึ๊บ

00:05:25.600 --> 00:05:31.500
แล้วก็ import type เมื่อกี้มาเนาะ index ปึ๊บ App ปึ๊บ ได้อย่างงี้

00:05:32.200 --> 00:05:35.000
ทีนี้ สมมุติไฟล์ซ้ายคือ server ไฟล์ขวาคือหน้าบ้านเนาะ

00:05:35.400 --> 00:05:40.300
ผมก็สามารถทำอย่างงี้ได้ ก็คือเรียก treaty อันนี้

00:05:40.600 --> 00:05:43.700
แล้วผมก็เขียนว่า endpoint เนี่ย อยากให้มันคุยไปที่ไหน

00:05:43.900 --> 00:05:47.600
ผมก็เขียนเป็น localhost 3000 เนาะ

00:05:47.900 --> 00:05:49.400
import declaration not found

00:05:49.500 --> 00:05:51.600
อ๋อ มัน name มันซ้ำกัน เอาเป็น api อะไรประมาณอย่างงี้

00:05:52.000 --> 00:05:54.400
ผมก็เรียก function นี้มา ผ่าน type เข้าไปในนี้

00:05:54.800 --> 00:05:55.800
แล้วก็เขียน endpoint

00:05:56.100 --> 00:05:58.100
ทีนี้ ตัว api ของเราก็จะสามารถคุยได้ว่า

00:05:58.300 --> 00:06:01.300
เหมือนจะมี auto complete ว่าเราอยาก get ที่ index ปึ๊บ

00:06:01.600 --> 00:06:04.400
แล้วก็มี method ขึ้นใช่ไหม ความเจ๋งก็คือ

00:06:04.600 --> 00:06:05.400
อันนี้มันก็จะบอกว่า

00:06:05.600 --> 00:06:07.200
ถ้าสมมุติผมตัด body ออกเนาะ ปึ๊บ

00:06:08.700 --> 00:06:10.600
ปึ๊บจะเห็นว่าตรงนี้ type มันไม่ error แล้ว

00:06:10.700 --> 00:06:12.800
เพราะว่าตรงนี้มันบอกไม่ต้องมี body อะไร

00:06:12.800 --> 00:06:13.500
แต่ถ้าเราใส่ body มา

00:06:13.600 --> 00:06:15.000
มันก็จะมี type ขึ้นอย่างนี้เนาะ

00:06:15.800 --> 00:06:17.000
อะไรประมาณอย่างนี้เราก็ใส่ให้ครบปึ๊บ

00:06:17.800 --> 00:06:18.800
age

00:06:19.700 --> 00:06:21.300
ใช่ มันก็จะ auto-complete ให้

00:06:21.300 --> 00:06:23.300
แล้วสมมติในอนาคตเรามี field เพิ่มขึ้นมาอีก

00:06:23.700 --> 00:06:24.400
ก็เอาเป็น

00:06:25.200 --> 00:06:25.900
อะไรดี

00:06:26.500 --> 00:06:29.800
boolean

00:06:30.300 --> 00:06:33.500
มันจะฟ้องว่า field เนี่ยมันขาดไปอันนึงนะ

00:06:33.600 --> 00:06:35.800
เพราะฉะนั้นเนี่ยมันก็เลยสามารถ sync type กันได้ใช่มั้ย

00:06:36.000 --> 00:06:38.100
ทีนี้เนี่ยอันนี้มันแอบ magic นิดนึง

00:06:38.300 --> 00:06:39.000
ก็คือตรงที่ว่า

00:06:39.300 --> 00:06:40.700
สิ่งที่มันทำจริงๆ แล้วเนี่ย

00:06:41.000 --> 00:06:42.600
มันไม่มีการ เห็นไหม มันไม่มีการ compile

00:06:42.700 --> 00:06:43.900
มันไม่มีอะไรเลย เราสามารถ run ได้เลย

00:06:44.000 --> 00:06:45.800
เดี๋ยวผม run ไฟล์นี้ให้ดูเลยว่าเกิดอะไรขึ้นเนาะ

00:06:46.800 --> 00:06:50.200
อันนี้ return body อันนี้กลับมาด้วย

00:06:50.400 --> 00:06:52.500
แล้วเราก็จะใส่ age มาอย่างนี้

00:06:53.200 --> 00:06:56.700
ปึ๊บ เอา await data error มา

00:06:57.200 --> 00:06:58.300
ทีนี้ถ้าเราลองดู

00:06:58.500 --> 00:06:59.700
มันจะเห็นว่า

00:07:00.100 --> 00:07:03.700
data ตรงนี้มันก็จะได้ data กับที่เรา return กลับมาเนาะ

00:07:04.200 --> 00:07:05.800
ทีนี้ไอ้ตรงนี้มันมี magic ก็คือ

00:07:06.100 --> 00:07:07.600
ตรงนี้มันไม่ได้มีการ compile

00:07:07.700 --> 00:07:08.600
ไม่ได้มีการทำอะไรๆ เลย

00:07:08.700 --> 00:07:11.000
มันแค่ import type มาแล้วเราก็ได้ทุกอย่างออกมา

00:07:11.200 --> 00:07:14.300
ปัญหาคือตอนเขียน JavaScript จริงๆ แล้วเนี่ย

00:07:15.100 --> 00:07:17.000
เวลาเรา compile TypeScript เนี่ย

00:07:17.200 --> 00:07:19.000
เวลาเรา compile TypeScript type

00:07:19.300 --> 00:07:20.400
มาเป็น JavaScript เนี่ย

00:07:20.800 --> 00:07:22.400
ตัว type เนี่ยมันจะหายไปก็คือ

00:07:22.800 --> 00:07:23.600
มันจะละลายหายไปเลย

00:07:23.800 --> 00:07:25.900
คือ JavaScript เนี่ยมันจะไม่เห็นว่ามันมี type อะไรอยู่เนาะ

00:07:26.800 --> 00:07:29.200
เพราะฉะนั้นเนี่ย

00:07:29.600 --> 00:07:30.700
สิ่งที่เกิดขึ้นจริงๆ ตรงนี้

00:07:31.600 --> 00:07:32.800
คือมันเป็นอะไรที่

00:07:32.900 --> 00:07:34.400
คุณลองคิดภาพ สมมติผมเปลี่ยนไฟล์นี้เป็น JavaScript เนี่ย

00:07:34.500 --> 00:07:37.200
มันก็ยังไม่มี auto-complete ไม่มีอะไร type check อะไรเลยใช่มั้ย

00:07:37.500 --> 00:07:39.000
แต่ว่ามันก็ยังทำงานได้อยู่นะ

00:07:39.800 --> 00:07:40.400
เพราะว่ามันใช้

00:07:40.900 --> 00:07:41.800
สิ่งที่เรียกว่า

00:07:42.300 --> 00:07:44.300
พูดง่ายๆ คือเราใช้

00:07:44.400 --> 00:07:47.100
type เนี่ยมาบอกว่า user ควรเขียนอะไร

00:07:47.300 --> 00:07:48.000
แต่จริงๆ แล้วเนี่ย

00:07:48.300 --> 00:07:49.100
ถ้าสมมติผมเขียนผิดเงี้ย

00:07:49.600 --> 00:07:50.700
มันก็ยัง run อยู่นะ

00:07:50.700 --> 00:07:51.900
เพียงแค่มัน run ไม่ถูก

00:07:52.200 --> 00:07:52.900
สมมติผม run ว่า

00:07:53.800 --> 00:07:54.300
ตรงนี้

00:07:54.600 --> 00:07:56.800
ผมเปลี่ยนอันนี้เป็น something else ละกัน

00:07:57.400 --> 00:07:57.900
เอาเป็น

00:07:58.000 --> 00:07:58.800
stage อะไรประมาณเงี้ย

00:07:59.100 --> 00:08:00.300
มันก็จะเห็นว่ามัน error ใช่มั้ย

00:08:00.500 --> 00:08:01.400
แต่จริงๆ แล้วเนี่ย

00:08:01.700 --> 00:08:03.300
ถึงแม้มันจะ error มันก็ยัง run ได้อยู่

00:08:03.700 --> 00:08:04.100
เพราะว่าจริงๆ แล้วเนี่ย

00:08:04.400 --> 00:08:06.900
ไอ้ตัวนี้ ตัว type ตัวนี้มันเป็นการเตือนว่า

00:08:07.300 --> 00:08:08.400
มันควรเขียนอย่างนี้นะ

00:08:08.600 --> 00:08:10.100
แต่จริงๆ แล้วคุณก็ยังเขียนได้อยู่

00:08:10.500 --> 00:08:12.400
ก็คือมันแบบว่า เรา

00:08:12.700 --> 00:08:13.300
แต่ว่า

00:08:13.300 --> 00:08:13.300
ปิ๊บ

00:08:14.100 --> 00:08:16.400
คือในความเป็นจริงแล้วเนี่ยคุณเห็น type error

00:08:16.400 --> 00:08:17.000
แล้วคุณก็คงไม่เขียนแล้วล่ะ

00:08:17.000 --> 00:08:18.700
ผมก็เลยจริงๆ แล้วเนี่ยอันนี้

00:08:18.800 --> 00:08:20.800
หลักการการทำงานของอันนี้มันง่ายมากเลย

00:08:20.900 --> 00:08:25.700
ก็คือคิดภาพว่า JavaScript เนาะเราก็จะใช้ API ตัวนึงที่ชื่อว่า proxy

00:08:25.800 --> 00:08:27.700
proxy เนี่ยเหมือนเป็นการบอกว่าเอ้ย

00:08:27.700 --> 00:08:32.000
ถ้าตัวนี้มันถูก access แล้วให้เราทำอะไรก็ได้เช่นผมบอกว่า get

00:08:32.400 --> 00:08:34.800
มันชื่อ get ป่ะผมจำไม่ได้เหมือนกัน

00:08:34.800 --> 00:08:35.900
เดี๋ยวนะ อ่า object อันนึงก่อน

00:08:35.900 --> 00:08:38.600
ทีนี้มันก็สามารถบอกว่าเอ้ยสมมุติ API ไอ้ตัวนี้

00:08:38.600 --> 00:08:41.200
ทำอะไรก็ตามที่อยู่ในนี้ get ก็คือ

00:08:41.500 --> 00:08:42.800
สมมุติผมเรียก get เนาะ

00:08:42.900 --> 00:08:45.900
get เนี่ยก็คือบอกว่าเอ้ยถ้าเราเรียก a.something

00:08:45.900 --> 00:08:47.800
อะไรประมาณนี้เป็น object ปกติ

00:08:48.100 --> 00:08:50.800
มันก็จะไป run ฟังก์ชันนี้แล้วให้เรา return อะไรกลับมาก็ได้

00:08:50.800 --> 00:08:52.000
เหมือนเป็นการดักว่าเอ้ย

00:08:52.300 --> 00:08:53.700
ถ้าฟังก์ชันนี้ถูกเรียกอ่ะ

00:08:53.800 --> 00:08:57.800
ก็ให้เราสามารถแบบเอ้ยอ่าน key อ่าน value

00:08:57.800 --> 00:08:59.300
ว่ามันพยายามจะทำอะไรอยู่

00:08:59.600 --> 00:09:03.000
สิ่งที่ผมทำจริงๆ เนี่ยด้วยความที่เราไม่รู้ว่า type มันคืออะไรเนาะ

00:09:03.000 --> 00:09:05.700
มันไม่สามารถอ่าน type ได้ผมก็เลยทำการบอกว่าเอ้ย

00:09:06.400 --> 00:09:10.500
หลักการของอันนี้ง่ายมากเลยคุณอยากได้ endpoint เท่าไหร่อ่ะ

00:09:10.500 --> 00:09:12.700
stage/a/b/c อย่างเงี้ย

00:09:12.700 --> 00:09:13.600
ผมก็บอกว่าเอ้ย

00:09:13.700 --> 00:09:17.800
ถ้าเรามี api.stage.a.b.c

00:09:17.800 --> 00:09:21.300
อันนี้ก็คือสิ่งที่ TypeScript เห็นก็คือสิ่งที่เราเห็นเนาะ

00:09:21.300 --> 00:09:22.700
เป็น end user เห็นแล้วเราก็ยัด type ลงไป

00:09:22.700 --> 00:09:25.100
สิ่งที่ code เห็นจริงๆ เนี่ยคือการทำอย่างเงี้ย

00:09:25.300 --> 00:09:27.200
ทำอย่างเงี้ยซ้ำไปเรื่อยๆ แล้วก็เรียกเอ้ย

00:09:27.900 --> 00:09:31.000
ถ้า method ตรงนี้มันอาจจะเอาเป็นว่า

00:09:31.600 --> 00:09:34.400
HTTP เนี่ยมันจะมีวิธีการเรียก method บางอันอยู่

00:09:34.400 --> 00:09:37.900
เช่นแบบ get post put อะไรพวกนี้แล้วผมก็แบบแก๊สไลท์ว่าเอ้ย

00:09:38.400 --> 00:09:40.500
ผมก็หลอก user ว่าด้วยความที่ผมน่ะ

00:09:40.800 --> 00:09:42.600
เราอยากให้ user อ่ะรู้ว่า

00:09:43.100 --> 00:09:43.800
ด้วยความที่แบบ

00:09:43.800 --> 00:09:46.900
เออเราอยากให้มันตรงนี้มันใช้งานได้ผมก็เลยแก๊สไลท์ user ว่า

00:09:47.500 --> 00:09:49.300
เอ้ยถ้าไอ้ตรงนี้

00:09:49.300 --> 00:09:53.300
ตรงนี้เป็นการเรียก method แล้วเป็นการเรียกฟังก์ชัน

00:09:54.100 --> 00:09:58.200
ผมก็เดาว่าเอ้ยตรงนี้มันก็น่าจะเป็นการเรียก endpoint แล้วมันไม่น่า

00:09:58.200 --> 00:10:01.100
ปกติสมมุติเป็น a อย่างเงี้ย .a อย่างเงี้ยคุณก็คงแบบว่าเอ้ย

00:10:01.100 --> 00:10:04.000
มันคงเรียกผ่านแหละมันไม่น่าใช่แบบการเรียกฟังก์ชัน

00:10:04.000 --> 00:10:06.400
ไม่น่าใช่การเรียก method เพื่อเรียก endpoint หรอกเนาะ

00:10:06.700 --> 00:10:09.300
ผมก็แก๊สไลท์ว่าเอ้ยถ้าคุณอยาก

00:10:09.300 --> 00:10:09.700
ผมก็

00:10:09.900 --> 00:10:10.300
เออ

00:10:10.600 --> 00:10:14.900
คือการเขียนอันนี้มันเป็นการแก๊สไลท์อย่างนึงแบบขั้นสุดเลยเว้ยก็คือตรงนี้

00:10:15.100 --> 00:10:20.100
เราไม่รู้ว่า user เนี่ยจะเรียก endpoint เมื่อไหร่

00:10:20.100 --> 00:10:21.900
สิ่งที่ผมทำก็คือบอกว่าแก๊สไลท์ว่าเอ้ย

00:10:22.200 --> 00:10:24.500
ถ้าคุณอยากเรียก endpoint นะคุณเรียก

00:10:24.500 --> 00:10:27.400
HTTP method แล้วก็ใส่ body เข้ามา

00:10:28.100 --> 00:10:31.400
ซึ่งเคสที่มันมีโอกาสเรียกจริงๆ เนี่ยอ่ะสมมุติ

00:10:31.400 --> 00:10:34.600
สมมุติผมเขียนอย่างงี้อ่ะเป็น state แล้ว get ใช่มั้ย

00:10:34.600 --> 00:10:35.000
อ่ะอย่างงี้เนาะ

00:10:35.000 --> 00:10:35.300
ปี

00:10:36.700 --> 00:10:37.500
ก็สามารถบอกว่า

00:10:38.100 --> 00:10:39.400
เรียก api.space.get

00:10:39.400 --> 00:10:42.100
แต่เห็นไหมว่าตรงนี้มันไม่มีการเรียกฟังก์ชัน

00:10:42.100 --> 00:10:43.700
เพราะว่ามันยังมีผาดด้านหลังอยู่

00:10:44.100 --> 00:10:45.800
แต่สมมุติว่าผมเรียก

00:10:45.800 --> 00:10:46.900
เป็นประมาณอย่างนี้

00:10:47.600 --> 00:10:49.800
api.stage.get

00:10:49.800 --> 00:10:51.200
ด้วยความที่ตรงนี้

00:10:51.200 --> 00:10:53.000
มันยังไม่ใช่การเรียก

00:10:53.000 --> 00:10:54.400
มันยังไม่ใช่การเรียกครั้งสุดท้าย

00:10:54.400 --> 00:10:56.100
เพราะฉะนั้นเนี่ยผมก็สามารถแก๊สไลท์ได้ว่า

00:10:56.100 --> 00:10:57.200
ถ้ามันเป็นครั้งสุดท้าย

00:10:57.200 --> 00:10:58.500
แล้วมันเป็นการเรียก

00:10:58.500 --> 00:11:00.900
ถ้ามันเป็นครั้งสุดท้ายแล้วไปต่อเนี่ย

00:11:00.900 --> 00:11:01.900
มันชื่อตรงกับ

00:11:02.200 --> 00:11:03.600
http verb อันนึง

00:11:03.800 --> 00:11:05.100
ก็ให้มันไปเรียก

00:11:05.100 --> 00:11:06.700
เราก็แทนที่จะรีเทิร์นอันนี้

00:11:06.700 --> 00:11:07.700
recursive เนาะ

00:11:07.700 --> 00:11:09.100
แล้วก็ไปเรียก fetch endpoint มา

00:11:09.100 --> 00:11:10.300
มันก็จะทำการ

00:11:10.300 --> 00:11:11.700
เรียก endpoint อีกทีนึง

00:11:11.700 --> 00:11:13.500
เพราะฉะนั้นเนี่ยสิ่งที่ผมทำจริงๆแล้วเนี่ย

00:11:13.500 --> 00:11:14.100
มันไม่ใช่ว่า

00:11:14.100 --> 00:11:15.700
เราเอา type แล้วเราก็

00:11:15.700 --> 00:11:17.800
get type แล้วก็

00:11:17.800 --> 00:11:18.600
แก้ something

00:11:18.600 --> 00:11:20.300
แต่มันเป็นการแบบว่าบอกว่า

00:11:20.300 --> 00:11:22.900
เราตรงนี้มาทำงานได้แบบ magic เลย

00:11:22.900 --> 00:11:24.300
คุณไม่ต้องไปซีเรียสเรื่องแบบ

00:11:24.300 --> 00:11:25.100
implementation หรอก

00:11:25.100 --> 00:11:26.000
เดี๋ยวเราจัดการเอง

00:11:26.000 --> 00:11:27.700
ซึ่ง implementation ด้านหลังจริงๆแล้วเนี่ย

00:11:27.700 --> 00:11:31.500
มันมี limit ทาง engineering อยู่

00:11:31.500 --> 00:11:32.200
ก็คือแบบว่า

00:11:32.500 --> 00:11:34.000
เราไม่สามารถ

00:11:34.000 --> 00:11:35.100
ดูได้ว่า

00:11:35.100 --> 00:11:37.400
proxy สุดท้ายที่มันถูกเรียกเนี่ย

00:11:37.400 --> 00:11:38.800
มันเป็นอันสุดท้ายหรือเปล่า

00:11:39.000 --> 00:11:41.100
เพราะฉะนั้นสิ่งที่เราสามารถทำได้ก็คือ

00:11:41.100 --> 00:11:43.600
บอกว่า user

00:11:43.600 --> 00:11:45.100
ถ้าคุณเรียกประมาณอย่างนี้

00:11:45.100 --> 00:11:46.700
แล้วเราเขียน method ที่ว่า

00:11:46.700 --> 00:11:48.600
มันน่าจะเป็นการเรียก endpoint เนี่ย

00:11:48.600 --> 00:11:49.700
เราก็เรียก endpoint

00:11:49.700 --> 00:11:50.600
ถ้าไม่ใช่แล้วก็ค่อย

00:11:50.600 --> 00:11:51.800
เรียกอย่างอื่น

00:11:51.800 --> 00:11:52.800
อะไรประมาณอย่างนี้

00:11:52.800 --> 00:11:54.500
ซึ่งมันเป็นสกิลการที่แบบว่า

00:11:54.500 --> 00:11:56.900
บางทีเนี่ยคุณเขียนแบบว่า

00:11:56.900 --> 00:11:58.600
เก่งมากๆแต่ว่า

00:11:59.100 --> 00:12:00.700
มัน มี edge case แหละ

00:12:00.700 --> 00:12:02.300
เราก็เลยบอก user ว่า

00:12:02.300 --> 00:12:04.000
ถ้าคุณเขียนประมาณอย่างนี้

00:12:04.000 --> 00:12:05.500
เราจะสามารถเลี่ยง edge case

00:12:05.500 --> 00:12:07.000
ที่เราเจอแล้วเรายังไม่สามารถแกะได้

00:12:07.000 --> 00:12:07.600
ก็บอกว่า

00:12:07.800 --> 00:12:09.000
ใน api.doc เนี่ย

00:12:09.000 --> 00:12:10.000
เราเขียนประมาณอย่างนี้นะ

00:12:10.000 --> 00:12:11.800
แล้วมันจะเจอโอกาสที่แบบ

00:12:11.800 --> 00:12:13.100
เลี่ยง edge case ที่แบบว่า

00:12:13.100 --> 00:12:13.900
ที่เราบอกไปเนี่ย

00:12:13.900 --> 00:12:14.800
มันให้มันลดลง

00:12:14.800 --> 00:12:16.400
เพราะฉะนั้นสิ่งที่เราทำจริงๆแล้วเนี่ย

00:12:16.400 --> 00:12:17.600
ในการเขียน framework

00:12:17.600 --> 00:12:18.400
มันไม่ใช่แค่แบบว่า

00:12:18.400 --> 00:12:20.600
คุณต้องเขียนแบบวางแพลนโคตรเก่งเลย

00:12:20.600 --> 00:12:21.700
แล้วก็แบบว่าเขียน implementation

00:12:21.700 --> 00:12:23.400
บางทีมันมีแบบ

00:12:23.400 --> 00:12:25.100
limit บางอย่างที่แบบเรา

00:12:25.100 --> 00:12:26.300
แก้ได้ค่อนข้างยาก

00:12:26.300 --> 00:12:27.900
แต่เราสามารถเลี่ยงได้ด้วยการแบบว่า

00:12:27.900 --> 00:12:29.600
เราเขียน

00:12:29.600 --> 00:12:31.800
illusion something ที่แบบ

00:12:31.800 --> 00:12:33.200
สร้างภาพลวง

00:12:33.200 --> 00:12:34.000
อันนึงออกมาว่า

00:12:34.000 --> 00:12:34.800
ถ้าเขียนอย่างนี้

00:12:34.800 --> 00:12:36.700
มันจะโอกาสที่เป็นไปได้

00:12:36.700 --> 00:12:37.800
มันน่าจะมากกว่านะ

00:12:37.800 --> 00:12:38.500
อะไรประมาณอย่างนี้

00:12:38.500 --> 00:12:39.000
แล้วก็แบบว่า

00:12:39.000 --> 00:12:40.500
หลอกให้ user เนี่ย

00:12:40.500 --> 00:12:42.100
เขียนเป็นประมาณที่เราต้องการ

00:12:42.100 --> 00:12:43.000
แล้วก็มันก็จะได้

00:12:43.000 --> 00:12:44.400
ตัว API ออกมาที่แบบ

00:12:44.400 --> 00:12:45.500
ที่เราต้องการเลย

00:12:45.500 --> 00:12:46.600
ก็ประมาณนี้ครับ

00:12:49.000 --> 00:12:50.300
12 นาทีพอดีด้วย
